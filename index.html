<!doctype html>
<html lang="en">

<head>
<meta charset="utf-8">

<title>Unretrofittable: Starting projects off right</title>

<meta name="description" content="Presentation from Pittsburgh Techfest 2014">
<meta name="author" content="Chris Winters">

<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<link rel="stylesheet" href="css/reveal.min.css">
<link rel="stylesheet" href="css/theme/sky.css" id="theme">

<!-- For syntax highlighting -->
<link rel="stylesheet" href="lib/css/zenburn.css">

<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
  if( window.location.search.match( /print-pdf/gi ) ) {
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = 'css/print/pdf.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  }
</script>

<!--[if lt IE 9]>
<script src="lib/js/html5shiv.js"></script>
<![endif]-->
</head>

<body>

<div class="reveal">

  <!-- Any section element inside of this container is displayed as a slide -->
<div class="slides">
  <section>
    <h1>Unretrofittable: Starting off right</h1>
    <h3>Some abstractions are hard to (un|re)do...</h3>
    <p>
      Chris Winters (@cwinters)
    </p>
    <p>
      Pittsburgh Techfest 2014
    </p>
  </section>

  <section>
    <h2>Things start out great</h2>
    <p>
      Greenfield projects are the <b>best</b>, right?
    </p>
    <aside class="notes">
Starting a new project is one of my favorite things. So many things to
play with, so much to discover.
    </aside>
  </section>

  <section>
    <img src="lib/images/charlie_bucket_with_golden_ticket.jpg" />
    <aside class="notes">
It's a gift to be able to work on something new. How many people here
have been on a new project in the last year? Ever?

How about a new or rewritten subsystem?
    </aside>
  </section>

  <section>
    <h2>It all made sense at the time</h2>

    <aside class="notes">
It's a gift because I've made none of my usual mistakes yet, or
encountered none of the troubling bugs, or run into difficult users,
or interfaced with other terrible systems, or eased into one of the
typical compromises.

All those things you do the more you're dirtied by the real world. And
you do them for good reasons that make sense at the time.
    </aside>

  </section>

  <section>
    <img src="lib/images/oh_my_ive_done_it_again.jpg" />

    <aside class="notes">
So I will do all these things. And so will you. What's worse, I'll
get so caught up in the learning, and the sheer joy of productivity
that I won't remember all the painful lessons from past systems when I
did those things.
    </aside>
  </section>

  <section>
    <h2>Does it matter why?</h2>
    <img src="lib/images/tumbleweed_blowing.gif" />

    <aside class="notes">
There are probably lots of reasons for this, but that's another
talk. The main one I want to talk about is our levels of abstraction
and some of the side effects of working with them at the right and
wrong levels.
    </aside>

  </section>

  <section>
    <h2>"agile" vs AGILE</h2>
    <img src="lib/images/au_lapin_agile.jpg" />

    <aside class="notes">
We all love "agile" (though not necessarily Agile). A good deal of
agile is geared toward making you the developer acutely aware of
everybody's joy and pain and tightening the feedback cycle between
your awareness of and influence on these things.
    </aside>
  </section>

  <section>
    <h2>Frying pan?</h2>
    <img src="lib/images/au_lapin_agile_rabbit.jpg" />
    <aside class="notes">
You probably didn't sign up for that, right? We have analysts and
product manager to take care of these things, right?
<br />
Nope, you're FULL STACK, and that includes the user.
    </aside>
  </section>

  <section>
    <h2>Help others be awesome</h2>
    <p>...what we do is a means, not an end</p>

    <aside class="notes">
It's hard to remember this sometimes -- the means is fun! But the end
is what we get paid for.
    </aside>
  </section>

  <section>
    <img src="lib/images/spiders_from_cocoon.jpg" />

    <aside class="notes">
One of the main levers we have to do this technically is to make our
systems easier to change.
<br /> <br />
Easy to change increases the opportunity for empathy. Empathy was
common theme at devopsdays last week: empathy with our co-workers,
with other areas of the organization, and most of all with users.
    </aside>
  </section>

  <section>
    <h2>Empathy with what?</h2>

    <aside class="notes">
Empathy with the role of our systems in their work (or in their lives,
but work and life are conjoining anyway, right?).

<br /> <br />

But more importantly what they DO. And this leads my assertion for
today: focusing on the tasks that users do as an organizing
abstraction will make your system a better one at whatever it's
attempting to do. Thinking about these tasks from the user's point of
view, and what needs to be done and reported on for these tasks, will
not only make your users happier, but it can lead to clarity on what
you should do when making new features.
    </aside>
  </section>

  <section>
    <h2>Side effects</h2>

    <aside class="notes">
      We'll also mention side effects. Sometimes they can be the main
      benefit, sometimes they're a risk or something to be mitigated,
      and sometimes the side effects can lead to other side effects,
      or enable other practices.
    </aside>
  </section>

  <section>
    <img src="lib/images/bees_colliding.gif" width="800" height="454" />
    <aside class="notes">
      Take a drink!
    </aside>
  </section>

  <section>
    <h2>Lever 1: Creating a usable system</h2>

    <p>One command to create a system with real(-ish) data.</p>
  </section>

  <section>
    <img src="lib/images/skepticalbaby.jpg" />

    <aside class="notes">
Seriously! It's part of the system just about everybody ignores,
because we're all content to limp along with the same set of data
we've always used and built up over our time on the project.
<br />
When you show your system to your family at home:
<br />
Does the data look real?
<br />
Are there users named first name First last name Last and first name First
and lastname Last2?
<br />
Do products in the catalog have appropriate photos, or are they all the same?
<br />
Do the clients have any projects assigned, witha history, or has
everything been created the day the system was initialized?
    </aside>
  </section>

  <section>
    <h2>Hard part: real(-ish)</h2>
    <p class="fragment" data-fragment-index="1">"But I have fixtures!"</p>
    <img class="fragment" data-fragment-index="2" src="lib/images/wat_emu.jpg" />

    <aside class="notes">
      What does "real" even mean?
    </aside>
  </section>

  <section>
    <h2>Can your domain experts edit them?</h2>
    <aside class="notes">
Of course not. Fixtures exist to stock your system with the bare
minimum of data to get it working, and they work on a table by table
basis. Your objects are mapped to tables, and the data flow directly
into them.
<br />
THIS SHOWS THE PROBLEM.
    </aside>
  </section>

  <section>
    <h2>Abstractions shape ideas</h2>

    <img src="lib/images/many_tables.jpg" />

    <aside class="notes">
How we store data winds up shaping how we think about and present
data. How many tools do we have to navigate this pathway? How many
applications have you encountered that are basically barfing database
relations to the user?
<br />
Even the tools that "just make it easy" to do this but have other
means are problemetic. People do what's easy.
    </aside>

  </section>

  <section>
    <h2>So many forms</h2>

    <img src="lib/images/wall_of_clipboards.jpg" />

    <aside class="notes">
For example, a hospital nurse focused on discharges things of that
discharge as a Thing. That One Thing in her mind probably spans one or two
dozen tables. How are you ever going to make that real,
or keep it real?
<br />
How can you hope to rope domain experts like her into defining your
data for you?

    </aside>
  </section>

  <section>
    <h2>Thinking in tasks</h2>

    <aside class="notes">
Users don't think in normalized database tables. They don't care about
efficiency, or query planners.
<br />
They do care a little bit about having to change data in multiple
places (but less than you think). They do care about completeness, and
about doing as little mapping from what they know to The System.
<br />
Our job is to mediate between the tasks and the metal. Most of us
focus on the metal when we should be focusing on the tasks. The metal
is what we read about, what we argue about, what we go to school for,
what we care about.
    </aside>
  </section>

  <section>
    <h2>Tasks will cause you pain</h2>

    <p>Fowler: "If it hurts, do it more often."</p>

    <aside class="notes">
This pain is good! Data that are too complex and hard to recreate will
give you pain early. That pain should be a pointer to your goals. And
in an ideal world that pain will induce you to change, but most often
it means you just don't do it.
    </aside>
  </section>

  <section>
    <h2>Side effects</h2>
    <p class="fragment" data-fragment-index="1">
      Quick startup for new hires or changing teams. Which means
      people can change teams more often!
    </p>
    <p class="fragment" data-fragment-index="2">
      Domain experts define and maintain data
    </p>
    <p class="fragment" data-fragment-index="3">
      Sales + marketing can create and customize demos
    </p>
    <p class="fragment" data-fragment-index="4">
      Potential users can create demos with their own data (woo cloud!)
    </p>
    <p class="fragment" data-fragment-index="5">
      Head off model drift and too-generic data models
    </p>
  </section>

  <section>
    <img src="lib/images/supercut_eyeglance_sideways.gif" width="864" height="454" />
    <aside class="notes">
      Take a drink!
    </aside>
  </section>

  <section>
    <h2>Lever 2: Audit</h2>
  </section>

  <section>
    <img src="lib/images/skepticalbaby.jpg" />
    <aside class="notes">
Seriously?! There aren't many terms that evoke enterprise software
more than "auditing".
<br />
TURNS OUT auditing has some great first and second-order effects that can make
lots of people (including you) extremely happy.
    </aside>
  </section>

  <section>

    <h2>Why do you even?</h2>
    <img src="lib/images/nature_trail_eye_play.jpg" />

    <aside class="notes">
The idea of an audit trail is to be able to answer "How did this thing
get this way?" at any point in its history. Who created it and what
did they define, who updated it with what data and when? Depending on
how detailed they can get they can be invluable for support staff,
though reciting back to a user the set of actions a user he took may
give your organization a Big Brother tinge.
    </aside>
  </section>

  <section>
    <h2>Cooler than it sounds</h2>
    <p>Users love this (mostly), support staff <b>adore</b> it</p>

    <aside class="notes">
To the outside world, it looks like you're adding determinism. This
crazy system they have to interact with _makes sense_, it's not just a
bunch of people guessing or shrugging and offering no help at all.
    </aside>
  </section>

  <section>
    <h2>More abstractions</h2>
    <img src="lib/images/tables_with_view.jpg" />
    <aside class="notes">
Most frameworks that help with auditing try and hook into your
persistence scheme. This is attractive because you're leveraging a
tool you already use to implement something orthogonal -- this is a
big reason we use frameworks!
    </aside>
  </section>

  <section>
    <h2>Refactoring resistant</h2>

    <aside class="notes">
These things can work decently well, but they can also resist
refactoring -- how can you represent the history of a logical record
when that history is tied to the physical representation of it (move
columns, remove/rename tables)? It may also be difficult to separate
the audited actions a user takes from side effects of those actions --
for example, if I decide to use a gift card when checking out from
Amazon it needs to not only put that in my shopping cart, but also
draw that amount down from some record somewhere else. And what if I
only use part of the gift card and Amazon has to store the remainder
for later?
    </aside>
  </section>

  <section>
    <h2>Record tasks, not results</h2>

    <aside class="notes">
Put another way, traditional auditing mechanisms record the results of
the actions. But I think we're more interested in recording the
actions themselves. So why don't do we do that? Similar to the tack in
loading data into a system, we can reuse those ideas and attach 'who'
and 'when' and 'from where' metadata about these actions.
    </aside>
  </section>

  <section>
    <h2>What could we do with that record?</h2>

    <aside class="notes">
Not only auditing, but replay. Replay for load, replay for modified
business logic, replay for debugging to get back to a point in
time. Maybe replay done elsewhere to run through an expensive
computation (risk profile) -- see Fowler's article on LMAX.
    </aside>
  </section>

  <section>
    <h2>Other side effects</h2>

    <p>Confidence in the system: things can be explained!</p>

    <p>Exposing intent -- <tt>RecoverPassword</tt>
    vs <tt>ResetPassword</tt>
    and <tt>SendPasswordRecoveryEmail</tt></p>
  </section>

  <section>
    <h2>Lever 3: Undo</h2>
    <img src="lib/images/keep_calm_and_click_undo.jpg" />
    <aside class="notes">
Lastly, we'll focus on an activity that's almost entirely end-user
focused. Undo.
    </aside>
  </section>

  <section>
    <img src="lib/images/baby_fight.jpg" width="540" height="374" />
    <aside class="notes">
Users have come to expect undo at the small scale, but not at the
large. So undoing a font change or typing should just be there.
<br />
But being able to undo an order placement, or a hospital admission, or
an import of a full school of students...
<br />
That's just magic. The sort of magic that users will LOVE YOU
for. People flip out that they can undo gmail deletions. What if they
accidentally import a spreadsheet of 500 students to the wrong school?
    </aside>
  </section>

  <section>
    <h2>Again with the tasks</h2>
    <aside class="notes">
Users expect undo at the action level and don't care about side
effects in your system. Undo should mean it's like the action never
happened. The form went in the shredder, the upload never happened.
<br />
There are tricks to doing this, and they depend on the type of
action. Both are far easier to implement at the beginning.
    </aside>
  </section>

  <section>
    <h2>Grace period</h2>
    <p>Wait a while to do your work, don't do it if asked</p>
    <aside class="notes">
I place an order, but I can cancel that order without consequence in
the half hour after it's been placed. (Efficiencies in logistics can
actually make this more difficult, ask Amazon.)
<br />
On the surface this may seem simple -- just do nothing until the grace
period is up -- I like solutions where we do nothing!
    </aside>
  </section>

  <section>
    <h2>No free lunch</h2>
    <img src="lib/images/hedgehog_trying_to_escape_top_hat.gif" />
    <aside class="notes">
But in reality you want to do everything EXCEPT the final action. For
example, you need to ensure your validation logic still fires because
you don't want the user to submit the order and walk away only to get
a "Your order is invalid" email a half hour later. This might be
tricky because validation logic may depend on some of the data being
persisted. (Transactions may fix that... as long as you can depend on
them and they're used consistently.)
<br />
None of this is impossible, just easier if you have it in mind from
the beginning
    </aside>
  </section>

  <section>
    <h2>Change as Commands</h2>
    <p>Represent change as commands, represent undone change as commands</p>
    <aside class="notes">
You've already created an abstraction for the user task so you've got
a great handle to undo that task. For commands that touch a lot of
records you'll have to associate them all, but again -- you've
probably already done __that__ because you want to re-display the
original task as the user entered it.
    </aside>
  </section>

  <section>
    <h2>Side effects</h2>
    <p>So much happiness!</p>
    <img src="lib/images/cat_jamming_on_headphones.gif" width="560" height="540" />
  </section>

  <section>
    <h2>Lever n: Feature flags</h2>

    <p><b>Compile/build</b> setting controlling feature
    accessibility</p>

    <aside class="notes">
      Compile/build is typical, not mandated; it speaks more to their
      typical scope.
      <br />
      <br />
      Who's using them?
    </aside>
  </section>

  <section>
    <h2>Why?</h2>

    <aside class="notes">
      Timing features to releases is harder than you'd think,
      particularly the older and larger your system gets. (Yes, this
      is a good argument for lots of small systems. That's another
      talk.)
    </aside>
  </section>

  <section>
    <img src="lib/images/daily_wtf_dependency_graph.png" />

    <aside class="notes">
Dependencies usually aren't this bad (crazy graph), but they can be
tricky. Feature X may require an update to a database table but
Feature Y also needs to update it, and the updates need to be done at
the same time.

BUT Feature X needs to be one two weeks before Feature Y.
    </aside>
  </section>

  <section>
    <h2>Thinking differently about features</h2>

    <p>Full functionality vs not breaking</p>

    <aside class="notes">
Instead of thinking of features as a discrete set of files
implementing a feature that get delievered (sorry, "merged") at once,
what if it were a set of changes that get delivered over time -- maybe
even a long time -- but none of which break existing functionality?
    </aside>
  </section>

  <section>
    <h2>Not the prettiest...</h2>
    <img src="lib/images/old_light_switches.jpg" />

    <aside class="notes">
      Most implementations can be kind of gross... See Kellan
      Elliott-McCrea's presentation on Change at Etsy for an
      example. (PHP, but still...)
    </aside>
  </section>

  <section>
    <h2>I'll just code that up...</h2>
    <p>You don't have to! (Flip, Setler, Togglz)</p>

    <aside class="notes">
      May even be able to use third party runtime A/B testing services
      for lightweight version.
    </aside>
  </section>

  <section>
    <h2>But I want clean!</h2>
    <aside class="notes">
      Having part of a feature's code released is okay! (Koan: is a
      feature even partially released if it cannot be used?)
    </aside>
  </section>

  <section>
    <h2>Side effects++</h2>

    <p>Release more often; A/B testing</p>

    <img src="lib/images/happy_chopsticks_eater.gif" width="418" height="360" />

    <aside class="notes">
      Releasing more often is good in and of itself. But it also means
      you're releasing smaller changes, which are generally less
      risky. Lowered risk increases development experimentation. And
      that can bubble up the organization in great ways.
    </aside>
  </section>

  <section>
    <h2>Related: Kill switch</h2>

    <img src="lib/images/emergency_stop.jpg" width="800" height="600"/>

    <aside class="notes">
      Who's using these?
    </aside>
  </section>

  <section>
    <h2>You might also know me...</h2>

    <p><b>Runtime</b> flag removing functionality due to
    disruption, planned or not</p>

    <aside class="notes">
      Credit card processor went down, some backend system has
      collapsed and we don't want to continue throwing traffic at it,
      etc. Results can be reduced functionality, or may even be hidden
      to user -- for exaample, orders are put into a queue and not
      touched but we can catchup later.
    </aside>
  </section>

  <section>
    <h2>Wouldn't read-only be nice?</h2>

    <p><b>Why?</b> Enabling schema change for broken databases</p>

    <aside class="notes">
      This could help you work around database shortcomings (MySQL
      5.5, how do substantial systems use this!?) by ensuring that you
      can keep your app up during blocking schema changes.
    </aside>
  </section>

  <section>
    <h2>Side effects</h2>

    <p>
      <b>&lt;discuss&gt;</b>What actually happens when things
      fail?<b>&lt;/discuss&gt;</b>
      <br />
      vs
      <br />
      <img src="lib/images/shrug.png" />
    </p>

    <aside class="notes">
      Most of the time these discussions are much better handled by
      other parts of the business, not you. Giving an easily
      understood hook into the ability to turn things off leads to
      discussions of what we should actually do when they're off.
    </aside>
  </section>

  <section>
    <h1>Thank you!</h1>
    <img src="lib/images/egon_eyebrows_closes_door.gif" width="660" height="548" />
  </section>

  <section>
    <h3>Photos</h3>

    <ul>
      <li><a href="https://www.flickr.com/photos/auselen/4155725406">Au Lapin Agile</a> (<a href="https://creativecommons.org/licenses/by-sa/2.0/">cc by-sa</a>)</li>
      <li><a href="https://www.flickr.com/photos/ox4photos/7355535046/">Au Lapin Agile (rabbit closeup)</a> (<a href="https://creativecommons.org/licenses/by-nc-sa/2.0/">cc by-nc-sa</a>)</li>
      <li><a href="https://www.flickr.com/photos/dumbledad/3225255407">Emergency Stop Button</a>  (<a href="https://creativecommons.org/licenses/by/2.0/">cc by</a>)</li>
      <li><a href="https://www.flickr.com/photos/leigh49137/12659520594">Keep calm and click undo</a> (<a href="https://creativecommons.org/licenses/by-nc-sa/2.0/">cc by-nc-sa</a>)</li>
      <li><a href="https://www.flickr.com/photos/k-peters/2941835302">Light trails (in Hong Kong)</a> (<a href="https://creativecommons.org/licenses/by-nc-nd/2.0/">cc by-nc-nd</a>)</li>
      <li><a href="https://www.flickr.com/photos/stefanointintoli/9996084176">Many Tables</a> (<a href="https://creativecommons.org/licenses/by-nd/2.0/">cc by-nd</a>)</li>
      <li><a href="https://www.flickr.com/photos/viamoi/3450521306">Nature Trail Eye Play</a> (<a href="https://creativecommons.org/licenses/by-nc-nd/2.0/">cc by-nc-nd</a>)</li>
      <li><a href="https://www.flickr.com/photos/paulcross/4333070249">Old Light Switches</a> (<a href="https://creativecommons.org/licenses/by/2.0/">cc by</a>)</li>
      <li><a href="https://www.flickr.com/photos/photophilde/2518101974">Spiders leaving the cocoon</a> (<a href="https://creativecommons.org/licenses/by-sa/2.0/">cc by-sa</a>)</li>
      <li><a href="https://www.flickr.com/photos/theo_reth/8477010686/">Tables with view</a> (<a href="https://creativecommons.org/licenses/by-nc-nd/2.0/">cc by-nc-nd</a>)</li>
      <li><a href="https://www.flickr.com/photos/pochateca/29142320/">Wall of clipboards</a> (<a href="https://creativecommons.org/licenses/by-nc-sa/2.0/">cc by-nc-sa</a>)</li>
    </ul>

<!--
      <li><a href="https://www.flickr.com/photos/schinkerj/3865922295">Zebras</a> (<a href="https://creativecommons.org/licenses/by-nc-sa/2.0/">cc by-nc-sa</a>)</li>
Star Trails over Greith - https://www.flickr.com/photos/herbraab/7905545644 - by-nc-nd
LaBarge Creek from Boulder Canyon Trail - https://www.flickr.com/photos/alanenglish/3134513172 - by-nc
-->
  </section>

  <section>
    <h2>References</h2>

      <ul>
        <li>Daily WTF (crazy graph)
      - <a href="http://thedailywtf.com/Articles/The-Enterprise-Dependency.aspx">The
      Enterprise Dependency</a></li>

        <li>David Copeland,
      <a href="http://www.naildrivin5.com/blog/2013/06/16/production-is-all-that-matters.html">"Production is all that matters"</a></li>

        <li>Kellan Elliott-McCrea,
      <a href="http://www.infoq.com/presentations/Etsy">Optimized for Change, Architecture at Etsy</a></li>

        <li>
          Martin Fowler,
          <a href="http://martinfowler.com/bliki/FeatureToggle.html">Feature Toggle</a>;
          <a href="http://martinfowler.com/bliki/FrequencyReducesDifficulty.html">Frequency Reduces Difficulty</a>;
          <a href="http://martinfowler.com/articles/lmax.html">LMAX</a>;
          <a href="http://martinfowler.com/eaaDev/EventSourcing.html">Event Sourcing</a>
          is quite meaty and has lots of other pointers to things
          like
          <a href="http://martinfowler.com/eaaDev/ParallelModel.html">Parallel Model</a>
          and
          <a href="http://martinfowler.com/eaaDev/RetroactiveEvent.html">Retroactive Event</a>
        </li>

        <li>Michael Nygard,
          <a href="http://amazon.com/Release-It-Production-Ready-Pragmatic-Programmers/dp/0978739213/">Release It!</a></li>

        <li>Adam Wiggins, <a href="http://12factor.net/">Twelve-factor app</a></li>
      </ul>
    </section>

</div>

</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.min.js"></script>

<script>

  // Full list of configuration options available here:
  // https://github.com/hakimel/reveal.js#configuration
  Reveal.initialize({
    width: 1280,
    height: 800,
    controls: true,
    progress: true,
    history: true,
    center: true,

    theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
    transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

    // Parallax scrolling
    // parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
    // parallaxBackgroundSize: '2100px 900px',

    // Optional libraries used to extend on reveal.js
    dependencies: [
      { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
      { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
      { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
      { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
    ]
  });

</script>

</body>
</html>
